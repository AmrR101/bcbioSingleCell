#' Known Markers Detected
#'
#' @rdname knownMarkersDetected
#' @name knownMarkersDetected
#' @author Michael Steinbaugh
#'
#' @param x All markers [data.frame] generated by
#'   [Seurat::FindAllMarkers()].
#' @param y Known markers imported by [readKnownMarkers()].
#' @param show Show [kable].
#'
#' @return [tibble].
NULL



# Constructors ====
# Currently supports [Seurat::FindAllMarkers()]
.groupMarkers <- function(df) {
    if (!is.data.frame(df)) stop("data.frame required")
    # Rename `gene` to `symbol` if necessary
    if ("gene" %in% colnames(df)) {
        df <- rename(df, symbol = .data[["gene"]])
    }
    df %>%
        remove_rownames %>%
        as("tibble") %>%
        camel %>%
        tidy_select(c("cluster", "symbol"), everything()) %>%
        group_by(.data[["cluster"]])
}



# Methods ====
#' @rdname knownMarkersDetected
#' @export
setMethod(
    "knownMarkersDetected",
    signature(object = "data.frame", known = "tbl_df"),
    function(object, known, show = TRUE) {
        markers <- .groupMarkers(object) %>%
            left_join(known, by = "symbol") %>%
            filter(!is.na(.data[["cellType"]]))
        if (isTRUE(show)) {
            kable(markers, caption = "Known markers detected") %>% show
        }
        markers
    })
