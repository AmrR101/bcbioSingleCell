<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Differential Expression — diffExp • bcbioSingleCell</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Differential Expression — diffExp" />

<meta property="og:description" content="Differential Expression" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bcbioSingleCell</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/hbc/bcbioSingleCell">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Differential Expression</h1>
    <small class="dont-index">Source: <a href='https://github.com/hbc/bcbioSingleCell/blob/master/R/AllGenerics.R'><code>R/AllGenerics.R</code></a>, <a href='https://github.com/hbc/bcbioSingleCell/blob/master/R/methods-diffExp.R'><code>R/methods-diffExp.R</code></a></small>
    <div class="hidden name"><code>diffExp.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Differential Expression</p>
    
    </div>

    <pre class="usage"><span class='fu'>diffExp</span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S4 method for SingleCellExperiment</span>
<span class='fu'>diffExp</span>(<span class='no'>object</span>, <span class='no'>numerator</span>, <span class='no'>denominator</span>,
  <span class='kw'>minCells</span> <span class='kw'>=</span> <span class='fl'>10L</span>, <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>1000L</span>)

<span class='co'># S4 method for seurat</span>
<span class='fu'>diffExp</span>(<span class='no'>object</span>, <span class='no'>numerator</span>, <span class='no'>denominator</span>, <span class='kw'>minCells</span> <span class='kw'>=</span> <span class='fl'>10L</span>,
  <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>1000L</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>Object.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments.</p></td>
    </tr>
    <tr>
      <th>numerator</th>
      <td><p>Group of cells to use in the numerator of the contrast
(e.g. treatment).</p></td>
    </tr>
    <tr>
      <th>denominator</th>
      <td><p>Group of cells to use in the denominator of the contrast
(e.g. control).</p></td>
    </tr>
    <tr>
      <th>minCells</th>
      <td><p>Minimum number of cells required per group.</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>The number of iterations for the EM-algorithm. 200 by default, but larger may be useful for large datasets (many samples). Convergence of the posterior probabilities can be checked by following the distribution of posterior probabilities over iterations with <code>plotW</code>. The EM-algorithm will automatically stop if convergence is achieved before the maximum number of iterations.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>DEGLRT</code>.</p>
    
    <h2 class="hasAnchor" id="zinger-edger"><a class="anchor" href="#zinger-edger"></a>zingeR-edgeR</h2>

    
    <p>We first perform a differential expression analysis using zingeR posterior
probabilities and focussing on the count component of the ZINB model. We use
edgeR to model the count component.</p>
<p>The weights are estimated with the core function of zingeR,
<code>zeroWeightsLS()</code>. It is important to be consistent with the normalization
procedure, i.e. if you use TMM normalization for the analysis, you should
also use it for estimating the zingeR posterior probabilities. The weights
can then be provided in the DGEList object which will be used for dispersion
estimation in the native edgeR <code>estimateDisp()</code> function.</p>
<p>After estimation of the dispersions and zingeR posterior probabilities, the
<code>glmWeightedF()</code> function is used for statistical inference. This is an
adapted function from the <code>glmLRT()</code> function of edgeR. It uses an F-test for
which the denominator degrees of freedom are by default adjusted according to
the downweighting of excess zeros (<code>ZI = TRUE</code>). Also, independent filtering
can be performed on the obtained p-values (<code>independentFiltering = TRUE</code>). We
use the independent filtering strategy that was originally implemented in
DESeq2. By default, the average fitted values are used as a filter criterion.</p>
<p>Consult the <a href='https://goo.gl/4rTK1w'>zingeR vignette v2</a> for additional
information.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><ul>
<li><p>DESeq2: We're trying to follow the conventions used in DESeq2 for
contrasts, defining the name of the factor in the design formula,
numerator, and denominator level for the fold change calculations. See
<code><a href='http://www.rdocumentation.org/packages/DESeq2/topics/results'>DESeq2::results()</a></code> for more information.</p></li>
<li><p>Seurat: Note that Seurat currently uses the convention <code>cells.1</code> for the
numerator and <code>cells.2</code> for the denominator. See <code><a href='http://www.rdocumentation.org/packages/Seurat/topics/DiffExpTest'>Seurat::DiffExpTest()</a></code>
for additional information.</p></li>
</ul></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># SingleCellExperiment ====</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='metrics.html'>metrics</a></span>(<span class='no'>cellranger_small</span>)
<span class='no'>numerator</span> <span class='kw'>&lt;-</span> <span class='fu'>rownames</span>(<span class='no'>x</span>)[<span class='fu'>which</span>(<span class='no'>x</span><span class='kw'>[[</span><span class='st'>"sampleName"</span>]] <span class='kw'>==</span> <span class='st'>"proximal"</span>)]
<span class='no'>denominator</span> <span class='kw'>&lt;-</span> <span class='fu'>rownames</span>(<span class='no'>x</span>)[<span class='fu'>which</span>(<span class='no'>x</span><span class='kw'>[[</span><span class='st'>"sampleName"</span>]] <span class='kw'>==</span> <span class='st'>"distal"</span>)]
<span class='no'>lrt</span> <span class='kw'>&lt;-</span> <span class='fu'>diffExp</span>(
    <span class='kw'>object</span> <span class='kw'>=</span> <span class='no'>cellranger_small</span>,
    <span class='kw'>numerator</span> <span class='kw'>=</span> <span class='no'>numerator</span>,
    <span class='kw'>denominator</span> <span class='kw'>=</span> <span class='no'>denominator</span>,
    <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>100L</span>
)</div><div class='output co'>#&gt; <span class='message'>Loading required namespace: zingeR</span></div><div class='output co'>#&gt; <span class='message'>Loading required namespace: edgeR</span></div><div class='output co'>#&gt; <span class='message'>converting counts to integer mode</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: edgeR</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: limma</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: 'limma'</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:BiocGenerics':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    plotMA</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: 'edgeR'</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:SingleCellExperiment':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    cpm</span></div><div class='output co'>#&gt; iteration: 1. mean conv.: 0
#&gt; iteration: 2. mean conv.: 0.16
#&gt; iteration: 3. mean conv.: 0.958
#&gt; iteration: 4. mean conv.: 0.986
#&gt; iteration: 5. mean conv.: 0.994
#&gt; iteration: 6. mean conv.: 0.998
#&gt; iteration: 7. mean conv.: 0.998
#&gt; iteration: 8. mean conv.: 1
#&gt; iteration: 9. mean conv.: 0.98
#&gt; iteration: 10. mean conv.: 1
#&gt; converged. </div><div class='output co'>#&gt; <span class='message'>Loading required package: genefilter</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: 'genefilter'</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from 'package:matrixStats':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    rowSds, rowVars</span></div><div class='input'><span class='fu'><a href='http://www.rdocumentation.org/packages/tibble/topics/glimpse'>glimpse</a></span>(<span class='no'>lrt</span><span class='kw'>[[</span><span class='st'>"table"</span>]])</div><div class='output co'>#&gt; Observations: 500
#&gt; Variables: 5
#&gt; $ logFC      &lt;dbl&gt; 0.17740165, 0.67929074, 1.25917593, -0.53085841, -1.4541...
#&gt; $ logCPM     &lt;dbl&gt; 10.050208, 8.730282, 10.027433, 12.389401, 8.905963, 8.6...
#&gt; $ LR         &lt;dbl&gt; 9.1513701, 106.3974491, 168.5623434, 309.4309766, 25.178...
#&gt; $ PValue     &lt;dbl&gt; 2.612343e-03, 9.251915e-23, 1.893677e-33, 2.417904e-54, ...
#&gt; $ padjFilter &lt;dbl&gt; 3.178032e-03, 2.141647e-22, 6.667875e-33, 2.281041e-53, ...</div><div class='input'>
<span class='co'># seurat ====</span>
<span class='co'># Expression in cluster 3 relative to cluster 2</span>
<span class='no'>numerator</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>Seurat</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/Seurat/topics/WhichCells'>WhichCells</a></span>(<span class='kw pkg'>Seurat</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/Seurat/topics/pbmc_small'>pbmc_small</a></span>, <span class='kw'>ident</span> <span class='kw'>=</span> <span class='fl'>3L</span>)
<span class='no'>denominator</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>Seurat</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/Seurat/topics/WhichCells'>WhichCells</a></span>(<span class='kw pkg'>Seurat</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/Seurat/topics/pbmc_small'>pbmc_small</a></span>, <span class='kw'>ident</span> <span class='kw'>=</span> <span class='fl'>2L</span>)
<span class='no'>lrt</span> <span class='kw'>&lt;-</span> <span class='fu'>diffExp</span>(
    <span class='kw'>object</span> <span class='kw'>=</span> <span class='kw pkg'>Seurat</span><span class='kw ns'>::</span><span class='no'><a href='http://www.rdocumentation.org/packages/Seurat/topics/pbmc_small'>pbmc_small</a></span>,
    <span class='kw'>numerator</span> <span class='kw'>=</span> <span class='no'>numerator</span>,
    <span class='kw'>denominator</span> <span class='kw'>=</span> <span class='no'>denominator</span>,
    <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>100L</span>
)</div><div class='output co'>#&gt; <span class='message'>converting counts to integer mode</span></div><div class='output co'>#&gt; iteration: 1. mean conv.: 0
#&gt; iteration: 2. mean conv.: 0.1913
#&gt; iteration: 3. mean conv.: 0.18696
#&gt; iteration: 4. mean conv.: 0.1913
#&gt; iteration: 5. mean conv.: 0.21304
#&gt; iteration: 6. mean conv.: 0.18696
#&gt; iteration: 7. mean conv.: 0.2087
#&gt; iteration: 8. mean conv.: 0.23043
#&gt; iteration: 9. mean conv.: 0.23043
#&gt; iteration: 10. mean conv.: 0.22174
#&gt; iteration: 11. mean conv.: 0.23478
#&gt; iteration: 12. mean conv.: 0.23913
#&gt; iteration: 13. mean conv.: 0.21739
#&gt; iteration: 14. mean conv.: 0.2087
#&gt; iteration: 15. mean conv.: 0.2087
#&gt; iteration: 16. mean conv.: 0.20435
#&gt; iteration: 17. mean conv.: 0.2087
#&gt; iteration: 18. mean conv.: 0.21739
#&gt; iteration: 19. mean conv.: 0.22609
#&gt; iteration: 20. mean conv.: 0.22609
#&gt; iteration: 21. mean conv.: 0.26957
#&gt; iteration: 22. mean conv.: 0.27391
#&gt; iteration: 23. mean conv.: 0.27391
#&gt; iteration: 24. mean conv.: 0.28261
#&gt; iteration: 25. mean conv.: 0.29565
#&gt; iteration: 26. mean conv.: 0.3
#&gt; iteration: 27. mean conv.: 0.3087
#&gt; iteration: 28. mean conv.: 0.32609
#&gt; iteration: 29. mean conv.: 0.33913
#&gt; iteration: 30. mean conv.: 0.33913
#&gt; iteration: 31. mean conv.: 0.34348
#&gt; iteration: 32. mean conv.: 0.33913
#&gt; iteration: 33. mean conv.: 0.34348
#&gt; iteration: 34. mean conv.: 0.34783
#&gt; iteration: 35. mean conv.: 0.35217
#&gt; iteration: 36. mean conv.: 0.36957
#&gt; iteration: 37. mean conv.: 0.38696
#&gt; iteration: 38. mean conv.: 0.39565
#&gt; iteration: 39. mean conv.: 0.40435
#&gt; iteration: 40. mean conv.: 0.41304
#&gt; iteration: 41. mean conv.: 0.41739
#&gt; iteration: 42. mean conv.: 0.42609
#&gt; iteration: 43. mean conv.: 0.43478
#&gt; iteration: 44. mean conv.: 0.44348
#&gt; iteration: 45. mean conv.: 0.44783
#&gt; iteration: 46. mean conv.: 0.46087
#&gt; iteration: 47. mean conv.: 0.47391
#&gt; iteration: 48. mean conv.: 0.48696
#&gt; iteration: 49. mean conv.: 0.5
#&gt; iteration: 50. mean conv.: 0.5
#&gt; iteration: 51. mean conv.: 0.5087
#&gt; iteration: 52. mean conv.: 0.52174
#&gt; iteration: 53. mean conv.: 0.52609
#&gt; iteration: 54. mean conv.: 0.54348
#&gt; iteration: 55. mean conv.: 0.55652
#&gt; iteration: 56. mean conv.: 0.57826
#&gt; iteration: 57. mean conv.: 0.57826
#&gt; iteration: 58. mean conv.: 0.58696
#&gt; iteration: 59. mean conv.: 0.60435
#&gt; iteration: 60. mean conv.: 0.6087
#&gt; iteration: 61. mean conv.: 0.62609
#&gt; iteration: 62. mean conv.: 0.64783
#&gt; iteration: 63. mean conv.: 0.66957
#&gt; iteration: 64. mean conv.: 0.69565
#&gt; iteration: 65. mean conv.: 0.72174
#&gt; iteration: 66. mean conv.: 0.74783
#&gt; iteration: 67. mean conv.: 0.77391
#&gt; iteration: 68. mean conv.: 0.77826
#&gt; iteration: 69. mean conv.: 0.78696
#&gt; iteration: 70. mean conv.: 0.7913
#&gt; iteration: 71. mean conv.: 0.79565
#&gt; iteration: 72. mean conv.: 0.80435
#&gt; iteration: 73. mean conv.: 0.82609
#&gt; iteration: 74. mean conv.: 0.83043
#&gt; iteration: 75. mean conv.: 0.83913
#&gt; iteration: 76. mean conv.: 0.85217
#&gt; iteration: 77. mean conv.: 0.86957
#&gt; iteration: 78. mean conv.: 0.88261
#&gt; iteration: 79. mean conv.: 0.89565
#&gt; iteration: 80. mean conv.: 0.91304
#&gt; iteration: 81. mean conv.: 0.92174
#&gt; iteration: 82. mean conv.: 0.93043
#&gt; iteration: 83. mean conv.: 0.93478
#&gt; iteration: 84. mean conv.: 0.93913
#&gt; iteration: 85. mean conv.: 0.94783
#&gt; iteration: 86. mean conv.: 0.95217
#&gt; iteration: 87. mean conv.: 0.95217
#&gt; iteration: 88. mean conv.: 0.95652
#&gt; iteration: 89. mean conv.: 0.98261
#&gt; iteration: 90. mean conv.: 0.98696
#&gt; iteration: 91. mean conv.: 0.98696
#&gt; iteration: 92. mean conv.: 0.9913
#&gt; iteration: 93. mean conv.: 0.9913
#&gt; iteration: 94. mean conv.: 0.9913
#&gt; iteration: 95. mean conv.: 0.9913
#&gt; iteration: 96. mean conv.: 0.9913
#&gt; iteration: 97. mean conv.: 0.9913
#&gt; iteration: 98. mean conv.: 0.99565
#&gt; iteration: 99. mean conv.: 0.99565
#&gt; iteration: 100. mean conv.: 1</div><div class='input'><span class='fu'><a href='http://www.rdocumentation.org/packages/tibble/topics/glimpse'>glimpse</a></span>(<span class='no'>lrt</span><span class='kw'>[[</span><span class='st'>"table"</span>]])</div><div class='output co'>#&gt; Observations: 230
#&gt; Variables: 5
#&gt; $ logFC      &lt;dbl&gt; 0.0000000, -1.4941343, 0.0000000, 0.8996484, 0.0000000, ...
#&gt; $ logCPM     &lt;dbl&gt; 12.98492, 13.08969, 12.98492, 13.71783, 12.98492, 13.005...
#&gt; $ LR         &lt;dbl&gt; 0.0000000, 2.0319785, 0.0000000, 1.0090244, 0.0000000, 1...
#&gt; $ PValue     &lt;dbl&gt; 1.00000000, 0.15417754, 1.00000000, 0.31525937, 1.000000...
#&gt; $ padjFilter &lt;dbl&gt; NA, 0.2459308, NA, 0.3972781, NA, NA, NA, NA, 0.3572848,...</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#zinger-edger">zingeR-edgeR</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Michael Steinbaugh

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://steinbaugh.com'>Michael Steinbaugh</a>, <a href='https://github.com/roryk'>Rory Kirchner</a>, <a href='https://github.com/marypiper'>Mary Piper</a>, <a href='https://github.com/vbarrera'>Victor Barrera</a>, <a href='https://github.com/sjhosui'>Shannan Ho Sui</a>, <a href='http://bioinformatics.sph.harvard.edu'>Harvard Chan Bioinformatics Core</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

